// Copy the entire line below and paste it in the visual editor.
{"id":222506598,"name":"Update Permission","keys":[null,null,null,null,null,null,null,[],null,null,null,null,null,null,[{"t":"p","d":{"a":{"t":"s","script":"// Deny\ncheckDenyFlashWritePermission();"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Deny\ncheckDenyFlashWritePermission();"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Deny\ncheckDenyFlashWritePermission();"}}}],null,[],[{"t":"p","d":{"a":{"t":"s","script":"// Allow\ncheckGrantFlashWritePermission();"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Allow\ncheckGrantFlashWritePermission();"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Allow\ncheckGrantFlashWritePermission();"}}}],null,null,null,null,null,[],null,null,null,null,[],null,null,null,null,null,null,null,null,null],"scripts":{"init":"if(#flag(local, \"Require permission to Update keyboard\", true)) {\n  if (!isInReinit()) disableFlashWrite();\n\n  const SCRIPT_ID_FLASH_WRITE_ACCESS_REQUESTED = 20;\n  setScript(SCRIPT_ID_FLASH_WRITE_ACCESS_REQUESTED, @onFlashWriteAccessAttempted);\n}"},"user_scripts":{"rgbUpdate":"const FLASH_WRITE_KEY_ORDER = [[ 00 01 02 03 04 05 06 07 08 09 0a 0b 0a 09 08 07 06 05 04 03 02 01 ]];\n\n#option(rgbUpdate, \"RGB Mode\", \"Update Access Prompt\", rgbUpdateKeyFlashWriteAccessPrompt)\nfunc rgbUpdateKeyFlashWriteAccessPrompt() {\n  for (var i = 0; i < 54; i = i + 1) {\n    setRgb(i, 0, 0, 0);\n  }\n\n  var index = getTime() >> 6;\n  var keyId = FLASH_WRITE_KEY_ORDER[index % 22];\n  setRgb(keyId, 16, 16, 16);\n\n  setRgb(14, 32, 0, 0);\n  setRgb(15, 32, 0, 0);\n  setRgb(16, 32, 0, 0);\n  setRgb(19, 0, 32, 0);\n  setRgb(20, 0, 32, 0);\n  setRgb(21, 0, 32, 0);\n}\n\n#option(rgbUpdateUnderglow, \"RGB Mode\", \"Update Access Prompt\",  rgbUpdateUnderglowOff) \n\n","Permission Scripts":"var preFlashWritePermissionLayer = -1;\n\nfunc onFlashWriteAccessAttempted() {\n  if (preFlashWritePermissionLayer == -1) {\n   preFlashWritePermissionLayer = layer;\n  }\n  _action_showFlashWritePermission();\n}\n\nfunc returnFromFlashWritePermission() {\n    deactivateGlobal();\n    deactivateDynamic();\n    layer = preFlashWritePermissionLayer;\n    preFlashWritePermissionLayer = -1;\n    activateDynamic();\n    activateGlobal();\n}\n\nfunc checkGrantFlashWritePermission() {\n  if (isButtonPressed(19) && isButtonPressed(20) && isButtonPressed(21)) {\n    enableFlashWrite();\n    returnFromFlashWritePermission();\n  }\n}\n\nfunc checkDenyFlashWritePermission() {\n  if (isButtonPressed(14) && isButtonPressed(15) && isButtonPressed(16)) {\n    returnFromFlashWritePermission();\n  }\n}\n"},"options":{"Always Power RGB":"true","RGB Mode":"Update Access Prompt","Enable individual keys in Key Layout tool":"true","Require permission to Update keyboard":"true"},"sequences":{"showFlashWritePermission":[{"t":"l","l":222506598}]}}