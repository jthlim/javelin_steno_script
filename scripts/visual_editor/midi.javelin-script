// Copy the entire line below and paste it in the visual editor.
{"id":76405514,"name":"MIDI","keys":[null,null,[{"t":"p","d":{"a":{"t":"s","script":"// C#\npressMidi(1);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(1);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// D#\npressMidi(3);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(3);\n"}}}],null,[{"t":"p","d":{"a":{"t":"s","script":"// F#\npressMidi(6);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(6);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// G#\npressMidi(8);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(8);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// A#\npressMidi(10);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(10);\n"}}}],null,[{"t":"p","d":{"a":{"t":"s","script":"// C#+1\npressMidi(13);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(13);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// D#+1\npressMidi(15);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(15);\n"}}}],null,null,[{"t":"p","d":{"a":{"t":"s","script":"// C\npressMidi(0);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(0);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// D\npressMidi(2);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(2);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// E\npressMidi(4);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(4);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// F\npressMidi(5);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(5);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// G\npressMidi(7);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(7);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// A\npressMidi(9);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(9);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// B\npressMidi(11);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(11);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// C+1\npressMidi(12);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(12);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// D+1\npressMidi(14);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(14);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// E+1\npressMidi(16);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(16);\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// F+1\npressMidi(17);\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidi(17);\n"}}}],null,null,null,null,null,null,[],null,null,null,null,[{"t":"p","d":{"a":{"t":"l","l":1128808786}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Octave -\nmidiOctaveDown();\n"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Octave +\nmidiOctaveUp();\n"}}}],null,[{"t":"p","d":{"a":{"t":"s","script":"// Sustain\nsendMidi(0xb0, 64, 127);"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nsendMidi(0xb0, 64, 0);"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Velocity -\npressMidiVelocityDown();\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidiVelocity();"}}}],[{"t":"p","d":{"a":{"t":"s","script":"// Velocity +\npressMidiVelocityUp();\n"}}},{"t":"r","d":{"a":{"t":"s","script":"//\nreleaseMidiVelocity();"}}}]],"scripts":{"header":"var midiOctave = 5;\nvar midiVelocity = 64;\nvar midiNoteBuffer = createBuffer(128);","init":"for (var i = 0; i < 32; i += 1) {\n  midiNoteBuffer[{i}] = -1;\n}\n"},"user_scripts":{"Midi Functions":"func pressMidi(noteOffset) {\n  var note = midiOctave*12 + noteOffset;\n  midiNoteBuffer[{noteOffset}] = note;\n\n  sendMidi(0x90, note, midiVelocity);\n  drawMidiDisplay0();\n}\n\nfunc releaseMidi(noteOffset) {\n  sendMidi(0x80, midiNoteBuffer[{noteOffset}], 0);\n  midiNoteBuffer[{noteOffset}] = -1;\n  drawMidiDisplay0();\n}\n\nfunc midiOctaveDown() {\n  if (midiOctave == 0) return;\n  midiOctave -= 1;\n  drawMidiDisplay1();\n}\n\nfunc midiOctaveUp() {\n  if (midiOctave > 8) return;\n  midiOctave += 1;\n  drawMidiDisplay1();\n}\n\nconst MIDI_VELOCITY_TIMERID = #line;\nfunc pressMidiVelocityUp() {\n  startTimer(MIDI_VELOCITY_TIMERID, 50, 1, @{\n    if (midiVelocity < 127) {\n      midiVelocity += 1;\n      drawMidiDisplay1();\n    }\n  });\n}\n\nfunc pressMidiVelocityDown() {\n  startTimer(MIDI_VELOCITY_TIMERID, 50, 1, @{\n    if (midiVelocity > 0) {\n      midiVelocity -= 1;\n      drawMidiDisplay1();\n    }\n  });\n}\n\nfunc releaseMidiVelocity() {\n  stopTimer(MIDI_VELOCITY_TIMERID);\n}\n\n// #prefab MIDI:C [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// C\\npressMidi(0);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(0);\\n\"}}}]\n// #prefab MIDI:C# [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// C#\\npressMidi(1);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(1);\\n\"}}}]\n// #prefab MIDI:D [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// D\\npressMidi(2);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(2);\\n\"}}}]\n// #prefab MIDI:D# [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// D#\\npressMidi(3);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(3);\\n\"}}}]\n// #prefab MIDI:E [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// E\\npressMidi(4);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(4);\\n\"}}}]\n// #prefab MIDI:F [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// F\\npressMidi(5);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(5);\\n\"}}}]\n// #prefab MIDI:F# [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// F#\\npressMidi(6);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(6);\\n\"}}}]\n// #prefab MIDI:G [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// G\\npressMidi(7);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(7);\\n\"}}}]\n// #prefab MIDI:G# [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// G#\\npressMidi(8);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(8);\\n\"}}}]\n// #prefab MIDI:A [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// A\\npressMidi(9);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(9);\\n\"}}}]\n// #prefab MIDI:A# [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// A#\\npressMidi(10);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(10);\\n\"}}}]\n// #prefab MIDI:B [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// B\\npressMidi(11);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(11);\\n\"}}}]\n// #prefab MIDI:C+1 [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// C+1\\npressMidi(12);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(12);\\n\"}}}]\n// #prefab MIDI:C#+1 [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// C#+1\\npressMidi(13);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(13);\\n\"}}}]\n// #prefab MIDI:D+1 [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// D+1\\npressMidi(14);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(14);\\n\"}}}]\n// #prefab MIDI:D#+1 [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// D#+1\\npressMidi(15);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(15);\\n\"}}}]\n// #prefab MIDI:E+1 [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// E+1\\npressMidi(16);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(16);\\n\"}}}]\n// #prefab MIDI:F+1 [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// F+1\\npressMidi(17);\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidi(17);\\n\"}}}]\n// #prefab MIDI:Octave - [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// Octave -\\nmidiOctaveDown();\\n\"}}}]\n// #prefab MIDI:Octave + [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// Octave +\\nmidiOctaveUp();\\n\"}}}]\n// #prefab MIDI:Sustain [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// Sustain\\nsendMidi(0xb0, 64, 127);\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nsendMidi(0xb0, 64, 0);\"}}}]\n// #prefab MIDI:Velocity - [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// Velocity -\\npressMidiVelocityDown();\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidiVelocity();\"}}}]\n// #prefab MIDI:Velocity + [{\"t\":\"p\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"// Velocity +\\npressMidiVelocityUp();\\n\"}}},{\"t\":\"r\",\"d\":{\"a\":{\"t\":\"s\",\"script\":\"//\\nreleaseMidiVelocity();\"}}}]\n","Midi Display":"#option(drawDisplay, \"Display\", \"MIDI\", drawMidi)\nfunc drawMidi() {\n  drawMidiDisplay0();\n  drawMidiDisplay1();\n}\n\nfunc drawMidiDisplay0() {\n  const NOTE_NAMES = [<\n    \"C\",\n    \"C#\",\n    \"D\",\n    \"D#\",\n    \"E\",\n    \"F\",\n    \"F#\",\n    \"G\",\n    \"G#\",\n    \"A\",\n    \"A#\",\n    \"B\"\n  >];\n\n  setAutoDraw(0, AUTO_DRAW_NONE);\n  clearDisplay(0);\n\n  var noteCount = 0;\n  for (var i = 0; i < 32; i += 1) {\n    if (midiNoteBuffer[{i}] != -1) {\n      noteCount += 1;\n    }\n  }\n\n  if (noteCount == 0) {\n    drawText(0, DISPLAY_WIDTH/2, DISPLAY_HEIGHT/2 + 12, 1, 1, \"-\");\n    return;\n  }\n\n  var y = DISPLAY_HEIGHT/2 + 12 - 12*(noteCount-1);\n  for (var i = 0; i < 32; i += 1) {\n    if (midiNoteBuffer[{i}] != -1) {\n      drawText(0, DISPLAY_WIDTH/2, y, 1, 1, NOTE_NAMES[<i % 12>]);\n      y += 24;\n    }\n  }\n\n}\n\nfunc drawMidiDisplay1() {\n  setAutoDraw(1, AUTO_DRAW_NONE);\n  clearDisplay(1);\n  drawText(1, DISPLAY_WIDTH/2, 32, 0, 1, \"Octave\");\n  drawMidiValueBar(midiOctave, 9, 50);\n  drawText(1, DISPLAY_WIDTH/2, 80, 0, 1, \"Velocity\");\n  drawMidiValueBar(midiVelocity, 127, 98);\n}\n\nfunc drawMidiValueBar(value, max, y) {\n  drawText(1, 10, y, 0, 1, formatString(\"%d\", value));\n\n  drawLine(1, 20, y - 8, DISPLAY_WIDTH - 4, y - 8);\n  drawLine(1, 19, y - 7, 19, y-1);\n  drawLine(1, 20, y, DISPLAY_WIDTH - 4, y);\n  drawLine(1, DISPLAY_WIDTH-3, y-7, DISPLAY_WIDTH-3, y-1);\n\n  drawRect(1, 20, y-7, 20 + (DISPLAY_WIDTH - 23) * value / max, y);\n}"},"options":{"Enable individual keys in Key Layout tool":"true","Display":"MIDI"},"sequences":{}}